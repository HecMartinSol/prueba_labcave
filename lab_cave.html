<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>PRUEBA LAB CAVE</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</head>
<body>

    <script src="jquery.js"></script>

    <div class="container">
        <div class="row">


            <div class="col-md-12">
                <h4>Bootstrap Snipp for Datatable</h4>
                <div class="table-responsive">


                    <table id="mytable" class="table table-bordred table-striped">

                        <thead>

                            <th><input type="checkbox" id="checkall" /></th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Address</th>
                            <th>Email</th>
                            <th>Contact</th>
                            <th>Edit</th>

                            <th>Delete</th>
                        </thead>
                        <tbody>

                            <tr>
                                <td><input type="checkbox" class="checkthis" /></td>
                                <td>Mohsin</td>
                                <td>Irshad</td>
                                <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                                <td>isometric.mohsin@gmail.com</td>
                                <td>+923335586757</td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Edit"><button
                                            class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal"
                                            data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>
                                    </p>
                                </td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Delete"><button
                                            class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal"
                                            data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>
                                    </p>
                                </td>
                            </tr>

                            <tr>
                                <td><input type="checkbox" class="checkthis" /></td>
                                <td>Mohsin</td>
                                <td>Irshad</td>
                                <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                                <td>isometric.mohsin@gmail.com</td>
                                <td>+923335586757</td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Edit"><button
                                            class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal"
                                            data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>
                                    </p>
                                </td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Delete"><button
                                            class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal"
                                            data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>
                                    </p>
                                </td>
                            </tr>


                            <tr>
                                <td><input type="checkbox" class="checkthis" /></td>
                                <td>Mohsin</td>
                                <td>Irshad</td>
                                <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                                <td>isometric.mohsin@gmail.com</td>
                                <td>+923335586757</td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Edit"><button
                                            class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal"
                                            data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>
                                    </p>
                                </td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Delete"><button
                                            class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal"
                                            data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>
                                    </p>
                                </td>
                            </tr>



                            <tr>
                                <td><input type="checkbox" class="checkthis" /></td>
                                <td>Mohsin</td>
                                <td>Irshad</td>
                                <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                                <td>isometric.mohsin@gmail.com</td>
                                <td>+923335586757</td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Edit"><button
                                            class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal"
                                            data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>
                                    </p>
                                </td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Delete"><button
                                            class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal"
                                            data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>
                                    </p>
                                </td>
                            </tr>


                            <tr>
                                <td><input type="checkbox" class="checkthis" /></td>
                                <td>Mohsin</td>
                                <td>Irshad</td>
                                <td>CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan</td>
                                <td>isometric.mohsin@gmail.com</td>
                                <td>+923335586757</td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Edit"><button
                                            class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal"
                                            data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>
                                    </p>
                                </td>
                                <td>
                                    <p data-placement="top" data-toggle="tooltip" title="Delete"><button
                                            class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal"
                                            data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>
                                    </p>
                                </td>
                            </tr>





                        </tbody>

                    </table>

                    <div class="clearfix"></div>
                    <ul class="pagination pull-right">
                        <li class="disabled"><a href="#"><span class="glyphicon glyphicon-chevron-left"></span></a></li>
                        <li class="active"><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">5</a></li>
                        <li><a href="#"><span class="glyphicon glyphicon-chevron-right"></span></a></li>
                    </ul>

                </div>

            </div>
        </div>
    </div>


    <div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span
                            class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                    <h4 class="modal-title custom_align" id="Heading">Edit Your Detail</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <input class="form-control " type="text" placeholder="Mohsin">
                    </div>
                    <div class="form-group">

                        <input class="form-control " type="text" placeholder="Irshad">
                    </div>
                    <div class="form-group">
                        <textarea rows="2" class="form-control"
                            placeholder="CB 106/107 Street # 11 Wah Cantt Islamabad Pakistan"></textarea>


                    </div>
                </div>
                <div class="modal-footer ">
                    <button type="button" class="btn btn-warning btn-lg" style="width: 100%;"><span
                            class="glyphicon glyphicon-ok-sign"></span> Update</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>



    <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span
                            class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                    <h4 class="modal-title custom_align" id="Heading">Delete this entry</h4>
                </div>
                <div class="modal-body">

                    <div class="alert alert-danger"><span class="glyphicon glyphicon-warning-sign"></span> Are you sure you
                        want to delete this Record?</div>

                </div>
                <div class="modal-footer ">
                    <button type="button" class="btn btn-success"><span
                            class="glyphicon glyphicon-ok-sign"></span> Yes</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span
                            class="glyphicon glyphicon-remove"></span> No</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

</body>
</html>


<script>


    const swapi_requester = {
        page_shown: 1,
        
        /**
         * Make the full process of getting and drawing a page of data
         * 
         * @param page
         */
        setupDatatable: function (page) {
            swapi_requester.page_shown = page,
                $("#currpage").html(swapi_requester.page_shown);

            swapi_requester.disableButton("next");
            swapi_requester.disableButton("previous");
            swapi_requester.toggleLoading();
            swapi_requester.clearRows();

            swapi_requester.getCharacters(page, function (response) {
                swapi_requester.drawResponse(response);
            });
        },
        /**
         * Draw the response data obtained on the table
         * 
         * @param response
         */
        drawResponse: function (response) {
            var msg = response.message;
            for (let i = 0; i < msg.results.length; i++) {
                const r = msg.results[i];
                swapi_requester.addRow(r);
            }

            if (msg.next != null) {
                var page = swapi_requester.getPageFromLink(msg.next);
                swapi_requester.enableButton("next", page);
            }
            else
                swapi_requester.disableButton("next");

            if (msg.previous != null) {
                var page = swapi_requester.getPageFromLink(msg.previous);
                swapi_requester.enableButton("previous", page);
            }
            else
                swapi_requester.disableButton("previous");

            swapi_requester.toggleLoading();


        },
        /**
         * Get de number of page using a link to the api
         * @param link
         */
        getPageFromLink: function (link) {
            // https://swapi.co/api/people/?page=2
            return link.split("=").pop();
        },
        /**
         * Switch visibility of the loading image
         * @param 
         */
        toggleLoading: function () {
            $("#img_loading").fadeToggle(500);
        },
        /**
         * Enable a button and sets its action to load another page
         * @param btn
         * @param page
         */
        enableButton: function (btn, page) {

            $("#" + btn + "_btn").attr("onclick", "swapi_requester.setupDatatable(" + page + ")");
            $("#" + btn + "_btn").fadeIn(500);
        },
        /**
         * Disables and hides a button
         * @param btn
         */
        disableButton: function (btn) {

            $("#" + btn + "_btn").removeAttr("onclick");
            $("#" + btn + "_btn").fadeOut(500);
        },
        /**
         * Clear the rows of the datatable
         * @param 
         */
        clearRows: function () {
            var dataTable = $('#characters_table').DataTable();

            dataTable.clear().draw();
        },
        /**
         * Add a row to the character datatable
         * @param character
         */
        addRow: function (character) {
            var dataTable = $('#characters_table').DataTable();

            dataTable.row.add([
                character.name,
                character.height,
                character.mass,
                character.hair_color,
                character.skin_color,
                character.eye_color,
                character.birth_year,
                character.gender
            ]).draw(false);
        },
        /**
         * Makes the AJAX request to the server and returns the result
         * once obtained data
         * 
         * @param page
         * @param callback
         */
        getCharacters: function (page = 1, callback) {
            $.ajax({
                type: "POST",
                url: "/get/characters",
                data: {
                    page: page
                },
                dataType: "json",
                success: function (response) {
                    return callback(response);
                }
            });
        }
    }


    $(document).ready(function () {
        var t = $('#characters_table').DataTable({
            paging: false,
            processing: true,
        });

        swapi_requester.setupDatatable(1);
    });

</script>